<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MATSim Example – Interactive Documentation</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --ink: #e5e7eb;
      --muted: #94a3b8;
      --accent: #22d3ee;
      --ok: #22c55e;
      --warn: #f59e0b;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: linear-gradient(180deg, #020617, var(--bg));
      color: var(--ink);
      line-height: 1.5;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
    }
    h1, h2, h3 { line-height: 1.2; }
    .hero {
      border: 1px solid var(--border);
      background: rgba(17,24,39,.85);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 18px;
    }
    .muted { color: var(--muted); }
    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      margin-top: 14px;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
    }
    .tabs { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .tabs button {
      border: 1px solid var(--border);
      color: var(--ink);
      background: #1e293b;
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
    }
    .tabs button.active { border-color: var(--accent); color: var(--accent); }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }
    details {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 10px;
    }
    summary { cursor: pointer; font-weight: 600; }
    code, pre {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: #0b1220;
      border: 1px solid #1e293b;
      border-radius: 8px;
    }
    code { padding: 2px 6px; }
    pre { padding: 10px; overflow-x:auto; }
    .step {
      display: flex;
      gap: 10px;
      align-items: start;
      margin: 8px 0;
    }
    .badge {
      min-width: 26px;
      height: 26px;
      display: inline-grid;
      place-items: center;
      border-radius: 999px;
      background: #0b1220;
      border: 1px solid var(--border);
      color: var(--accent);
      font-weight: 700;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid var(--border); padding: 8px; text-align: left; vertical-align: top; }
    th { background: #111827; }
    .ok { color: var(--ok); }
    .warn { color: var(--warn); }
    .tool {
      width: 100%;
      min-height: 120px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--ink);
      padding: 10px;
    }
    .btn {
      margin-top: 8px;
      border: 1px solid var(--accent);
      color: var(--accent);
      background: transparent;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
    }
    .footer { margin-top: 24px; font-size: .9rem; color: var(--muted); }
  </style>
</head>
<body>
<div class="container">
  <section class="hero">
    <h1>MATSim Example Project: Interactive Guide</h1>
    <p class="muted">Use this page to quickly understand the repository and how to prepare your own files to create a synthetic population workflow.</p>
    <div class="grid">
      <div class="card">
        <h3>What this repo gives you now</h3>
        <ul>
          <li>MATSim Java simulation runners.</li>
          <li>An example scenario at <code>scenarios/equil</code>.</li>
          <li>Python entry points for build/run convenience.</li>
        </ul>
      </div>
      <div class="card">
        <h3>What you still need for synthesis</h3>
        <ul>
          <li>Raw source data (census, surveys, land use, skim matrices).</li>
          <li>A transformation script to generate <code>plans.xml</code>.</li>
          <li>Validation checks against known totals.</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Explore by topic</h2>
    <div class="tabs" id="tabs"></div>

    <div id="panel-overview" class="tab-panel">
      <p>Think of the workflow as: <strong>raw files → synthetic population → MATSim plans → run simulation</strong>.</p>
      <div class="step"><span class="badge">1</span><div>Collect/clean raw household and person attributes.</div></div>
      <div class="step"><span class="badge">2</span><div>Generate agents (people) and households with realistic demographics.</div></div>
      <div class="step"><span class="badge">3</span><div>Create daily activities + trips and export to MATSim <code>plans.xml</code>.</div></div>
      <div class="step"><span class="badge">4</span><div>Reference the plans file in <code>config.xml</code> and run MATSim.</div></div>
    </div>

    <div id="panel-files" class="tab-panel">
      <table>
        <thead><tr><th>Your Input File</th><th>Purpose</th><th>Typical Output</th></tr></thead>
        <tbody>
          <tr><td>households.csv</td><td>Household size, income, location zone</td><td>households.xml or in-memory household objects</td></tr>
          <tr><td>persons.csv</td><td>Age, sex, worker/student flags, household id</td><td>person agents attached to households</td></tr>
          <tr><td>od_matrix.csv</td><td>Trip attraction/distribution hints</td><td>origin-destination choice model inputs</td></tr>
          <tr><td>facilities.geojson</td><td>Activity opportunities (home/work/shop/etc.)</td><td>activity location assignment</td></tr>
          <tr><td>network.xml</td><td>Transport network</td><td>routing + simulation network</td></tr>
        </tbody>
      </table>
      <p class="muted">In this repository, <code>scenarios/equil/plans100.xml</code> is already prepared and can be used as a structure example.</p>
    </div>

    <div id="panel-run" class="tab-panel">
      <h3>Run commands</h3>
      <pre>python main.py build --skip-tests
python main.py run --build --skip-tests</pre>
      <h3>Or via Python helper</h3>
      <pre>python src/main/python/pipeline_runner.py</pre>
      <h3>If you build your own synthetic population</h3>
      <ol>
        <li>Place generated plans file under a scenario, e.g. <code>scenarios/myScenario/plans.xml</code>.</li>
        <li>Edit matching <code>config.xml</code> to point to your plans and network files.</li>
        <li>Run with <code>RunMatsim</code> entry point.</li>
      </ol>
    </div>

    <div id="panel-checklist" class="tab-panel">
      <details open>
        <summary>Quick readiness checklist</summary>
        <ul>
          <li><span class="ok">✔</span> Every person references an existing household id.</li>
          <li><span class="ok">✔</span> Activity chains are logical (home → work/school → home).</li>
          <li><span class="ok">✔</span> Coordinates/zones map to the MATSim network extent.</li>
          <li><span class="warn">⚠</span> Validate totals (population, workers, students) against official benchmarks.</li>
        </ul>
      </details>
      <details>
        <summary>Common mistakes</summary>
        <ul>
          <li>Missing plan end-times or overlapping activities.</li>
          <li>Unreachable facilities due to network mismatch.</li>
          <li>Demographic distributions drifting away from source data.</li>
        </ul>
      </details>
    </div>

    <div id="panel-tool" class="tab-panel">
      <h3>Mini helper: infer next steps from your file list</h3>
      <p class="muted">Paste file names (one per line), then click analyze.</p>
      <textarea id="fileInput" class="tool" placeholder="Example:
households.csv
persons.csv
od_matrix.csv
facilities.geojson"></textarea>
      <br />
      <button class="btn" id="analyzeBtn">Analyze my files</button>
      <div id="analysis" style="margin-top:12px"></div>
    </div>
  </section>

  <p class="footer">Tip: host this <code>docs/index.html</code> with GitHub Pages to share documentation with your team.</p>
</div>

<script>
  const tabs = [
    ["overview", "Overview"],
    ["files", "Input files mapping"],
    ["run", "How to run"],
    ["checklist", "Validation checklist"],
    ["tool", "File analyzer"]
  ];

  const tabsContainer = document.getElementById("tabs");
  function activate(id) {
    document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
    document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
    document.getElementById(`panel-${id}`).classList.add("active");
    document.querySelector(`[data-tab='${id}']`).classList.add("active");
  }

  tabs.forEach(([id, label], i) => {
    const button = document.createElement("button");
    button.textContent = label;
    button.dataset.tab = id;
    button.onclick = () => activate(id);
    tabsContainer.appendChild(button);
    if (i === 0) activate(id);
  });

  document.getElementById("analyzeBtn").addEventListener("click", () => {
    const raw = document.getElementById("fileInput").value.toLowerCase();
    const lines = raw.split(/\n+/).map(x => x.trim()).filter(Boolean);
    const has = key => lines.some(l => l.includes(key));

    const suggestions = [];
    if (has("household")) suggestions.push("Great: household-level data detected.");
    else suggestions.push("Add a household file (e.g., households.csv).");

    if (has("person")) suggestions.push("Great: person-level data detected.");
    else suggestions.push("Add a persons file linked by household_id.");

    if (has("od") || has("matrix")) suggestions.push("OD/matrix data found: useful for trip distribution.");
    else suggestions.push("Optional: include OD matrix for better travel pattern realism.");

    if (has("facility") || has("poi") || has("geojson")) suggestions.push("Facility/location data found: good for assigning activities.");
    else suggestions.push("Add facility/POI/location data for realistic activity placement.");

    if (has("network") || has(".xml")) suggestions.push("Network-related file found.");
    else suggestions.push("Make sure you have a MATSim-compatible network.xml.");

    const html = `<div class="card"><h4>Recommended next steps</h4><ol>${suggestions.map(s => `<li>${s}</li>`).join("")}</ol></div>`;
    document.getElementById("analysis").innerHTML = html;
  });
</script>
</body>
</html>
